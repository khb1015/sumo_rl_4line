# scenario.py (개념)
import numpy as np
import traci, random
import gymnasium as gym
from gymnasium import spaces
from copy import deepcopy

SCENARIOS = {
        "scenario_A": {  # 보통 패턴 (아침 ↑ 점심 ↓ 저녁 ↑)
            (0, 300): {
                "4175105101": (0.03, 200),
                "8952652973": (0.03, 200),
                "4177516258": (0.03, 200),
                "5120772423": (0.03, 200),
            },
            (300, 600): {
                "4175105101": (0.01, 180),
                "8952652973": (0.01, 180),
                "4177516258": (0.01, 180),
                "5120772423": (0.01, 180),
            },
            (600, 900): {
                "4175105101": (0.03, 220),
                "8952652973": (0.03, 220),
                "4177516258": (0.03, 220),
                "5120772423": (0.03, 220),
            }
        },

        "scenario_B": {  # 점심이 제일 혼잡한 패턴
            (0, 300): {
                "4175105101": (0.01, 180),
                "8952652973": (0.01, 180),
                "4177516258": (0.01, 180),
                "5120772423": (0.01, 180),
            },
            (300, 600): {
                "4175105101": (0.04, 230),
                "8952652973": (0.04, 230),
                "4177516258": (0.04, 230),
                "5120772423": (0.04, 230),
            },
            (600, 900): {
                "4175105101": (0.02, 200),
                "8952652973": (0.02, 200),
                "4177516258": (0.02, 200),
                "5120772423": (0.02, 200),
            }
        },

        "scenario_C": {  # 하루종일 낮은 트래픽
            (0, 300): {
                "4175105101": (0.01, 150),
                "8952652973": (0.01, 150),
                "4177516258": (0.01, 150),
                "5120772423": (0.01, 150),
            },
            (300, 600): {
                "4175105101": (0.01, 150),
                "8952652973": (0.01, 150),
                "4177516258": (0.01, 150),
                "5120772423": (0.01, 150),
            },
            (600, 900): {
                "4175105101": (0.01, 150),
                "8952652973": (0.01, 150),
                "4177516258": (0.01, 150),
                "5120772423": (0.01, 150),
            }
        },

        "scenario_D": {  # 하루종일 매우 높은 트래픽
            (0, 300): {
                "4175105101": (0.04, 250),
                "8952652973": (0.04, 250),
                "4177516258": (0.04, 250),
                "5120772423": (0.04, 250),
            },
            (300, 600): {
                "4175105101": (0.04, 250),
                "8952652973": (0.04, 250),
                "4177516258": (0.04, 250),
                "5120772423": (0.04, 250),
            },
            (600, 900): {
                "4175105101": (0.04, 250),
                "8952652973": (0.04, 250),
                "4177516258": (0.04, 250),
                "5120772423": (0.04, 250),
            }
        }
        
    }

SCENARIO_MAP = {
        "A": SCENARIOS["scenario_A"],
        "B": SCENARIOS["scenario_B"],
        "C": SCENARIOS["scenario_C"],
        "D": SCENARIOS["scenario_D"]
    }
def build_scenario(scenario_name, custom_flows=None):
    if scenario_name != "custom":
        scenario = deepcopy(SCENARIO_MAP[scenario_name])
    else:
        scenario = deepcopy(SCENARIOS["scenario_C"])

        if custom_flows:
            for period_key, flows in custom_flows.items():
                start, end = map(int, period_key.split("_"))
                for node, new_rate in flows.items():
                    old_rate, old_delay = scenario[(start, end)][node]
                    scenario[(start, end)][node] = (new_rate, old_delay)

    return {
        "scenario": scenario_name,
        "time_periods": scenario
    }


